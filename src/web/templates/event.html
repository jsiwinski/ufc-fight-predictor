{% extends "base.html" %}

{% block title %}{{ event.event_name if event else 'Event Not Found' }}{% endblock %}

{% block content %}
{% if error %}
<div class="error-message">
    <h2>Event Not Found</h2>
    <p>{{ error }}</p>
    <p style="margin-top: 20px;"><a href="/">Back to Home</a></p>
</div>
{% elif event %}
<div class="event-header">
    <h1 class="event-name">{{ event.event_name }}</h1>
    <p class="event-meta">{{ event.event_date }}</p>
    <p class="event-summary">
        {{ event.fight_count }} fights &middot;
        Model confidence: {{ event.confidence_counts.HIGH }} High, {{ event.confidence_counts.MEDIUM }} Medium, {{ event.confidence_counts.LOW }} Low
    </p>
</div>

{% if event.is_backtest %}
<div class="backtest-banner">
    <div>
        <span class="label">Backtest Results</span>
    </div>
    <div class="result">
        {{ event.correct }}/{{ event.total }} correct
    </div>
    <div class="accuracy">
        {{ event.accuracy_pct }}% accuracy
    </div>
</div>
{% endif %}

<div class="fight-list">
    {% for fight in event.predictions %}
    <div class="fight-card {% if fight.position_label == 'Main Event' %}main-event{% endif %}">
        {% if fight.position_label %}
        <div class="fight-position">{{ fight.position_label }}</div>
        {% endif %}

        <div class="fight-row">
            {# Fighter 1 (Left Side) #}
            <div class="fighter-side left">
                <div class="prob-display">
                    <span class="probability red">{{ fight.f1_pct }}%</span>
                    <div class="prob-bar-container">
                        <div class="prob-bar" style="width: {{ (fight.f1_prob * 100)|int }}%;"></div>
                    </div>
                </div>
                <div class="fighter-info">
                    <div class="fighter-name">{{ fight.fighter1 }}</div>
                    <div class="fighter-meta">{{ fight.weight_class }}</div>
                    {% if not fight.f1_exact_match %}
                    <div class="match-warning">Matched to: {{ fight.fighter1_matched }}</div>
                    {% endif %}
                </div>
            </div>

            {# Center Divider #}
            <div class="vs-divider">vs</div>

            {# Fighter 2 (Right Side) #}
            <div class="fighter-side right">
                <div class="fighter-info">
                    <div class="fighter-name">{{ fight.fighter2 }}</div>
                    <div class="fighter-meta">{{ fight.weight_class }}</div>
                    {% if not fight.f2_exact_match %}
                    <div class="match-warning">Matched to: {{ fight.fighter2_matched }}</div>
                    {% endif %}
                </div>
                <div class="prob-display">
                    <div class="prob-bar-container">
                        <div class="prob-bar" style="width: {{ (fight.f2_prob * 100)|int }}%;"></div>
                    </div>
                    <span class="probability blue">{{ fight.f2_pct }}%</span>
                </div>
            </div>
        </div>

        {# Confidence Badge #}
        <div style="text-align: center;">
            <span class="confidence-badge {% if fight.confidence == 'HIGH' %}high{% endif %}">{{ fight.confidence }}</span>
        </div>

        {# Fight Details (visible on hover) #}
        {% if fight.factors %}
        <div class="fight-details">
            <div class="fight-factors">
                {% for factor in fight.factors %}
                <div class="factor">
                    <span class="factor-name">{{ factor.name }}:</span>
                    <span class="factor-value">{{ factor.value }}</span>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        {# Backtest Result #}
        {% if event.is_backtest and fight.actual_winner %}
        <div class="result-indicator {% if fight.correct %}correct{% else %}wrong{% endif %}">
            {% if fight.correct %}
            Correct — {{ fight.actual_winner }} won via {{ fight.method }}
            {% else %}
            Wrong — {{ fight.actual_winner }} won via {{ fight.method }}
            {% endif %}
        </div>
        {% endif %}
    </div>
    {% endfor %}
</div>
{% endif %}
{% endblock %}
